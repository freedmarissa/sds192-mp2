---
title: "Mini-Project 2"
author: "Marissa Freed, Natasha Rosenthal, & Margaret Welsh"
date: "March 31, 2018"
output: 
  html_document:
    code_folding: hide
---

Question: In contested House elections, looking at Democrats versus Republicans, who spends more money? Whose money is spent more effectively (which candidates win)? 
Does incumbency affect spending in contested elections?

## Loading the data
This project is so interesting and relevant to my life!

```{r, include=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```
Viewing the data
```{r}
head(house_elections)
head(candidates)
head(committees)
head(contributions)
```
filtered contributions by pro and against 
```{r}
contributions %>%
  group_by(transaction_type) %>%
  summarize(n_ish = n_distinct(transaction_type))
against_list <- c("24A", "24N")
pro_contributions <- contributions %>%
  filter(transaction_type != against_list) %>%
  select(-employer, -occupation, -sub_id)
pro_contributions
anti_contributions <- contributions %>%
  filter(transaction_type == against_list)%>%
  select(-employer, -occupation, -sub_id)
anti_contributions
```

filter out list of candidates to workable d/r
```{r}
house_demsreps <- house_elections %>%
  filter(party == "R" | party == "D", general_votes != 0) %>%
  mutate(st_dist = paste(state, district)) %>%
  select(-state, -district, -primary_votes, -runoff_votes) 
glimpse(house_demsreps)
```

combined contributions and people data sets
```{r}
cand_conts <- contributions %>%
  group_by(cmte_id, cand_id) %>%
  rename(fec_id = cand_id) %>%
  summarize(total_cont = sum(transaction_amt)) %>%
  inner_join(house_demsreps)
glimpse(cand_conts)
```

total contributions for each candidate
```{r}
totcont_percandidate <- cand_conts%>%
  group_by(fec_id, candidate_name, incumbent, party, general_votes, ge_winner, st_dist) %>%
  summarize(totaldonations = sum(total_cont))
glimpse(totcont_percandidate)
```

```{r}
contested_districts <- totcont_percandidate %>%
  group_by(st_dist) %>%
  summarize(cont = n_distinct(fec_id)) %>%
  filter(cont != 1)

contested_contributions <- contested_districts %>%
  inner_join(totcont_percandidate, by = "st_dist")
contested_contributions
contested_contributions %>%
  summarize(ndist = n_distinct(st_dist))
```

Making the data graphic

```{r}
contested_contributions %>%
  ggplot(aes(x = candidate_name, y = totaldonations, col = incumbent)) +
  facet_wrap(~ge_winner) +
  geom_col()

contested_contributions %>%
  ggplot(aes(x = candidate_name, y = totaldonations, col = incumbent)) +
  facet_wrap(~party) +
  geom_col()
```




