---
title: "Mini-Project 2"
author: "Marissa Freed, Natasha Rosenthal, & Margaret Welsh"
date: "March 31, 2018"
output: 
  html_document:
    code_folding: hide
---

Question: In contested House elections, looking at Democrats versus Republicans, who spends more money? Whose money is spent more effectively (which candidates win)? 
Does incumbency affect spending in contested elections?
To do: 
> Find who spends more money total: democrats or republicans? **
> Who wins more? Spends less doing so? (what percent of total spending for each race does the winner spend)
> Do incumbents spend more or less than their opposition? Does it differ for republicans and democrats? ***

## Loading the data
This project is so interesting and relevant to my life!

```{r, include=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(treemap)
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```
Viewing the data
```{r}
head(house_elections)
head(candidates)
head(committees)
head(contributions)
```
filtered contributions by pro and against 
```{r}
contributions %>%
  group_by(transaction_type) %>%
  summarize(n_ish = n_distinct(transaction_type))
against_list <- c("24A", "24N")
pro_contributions <- contributions %>%
  filter(transaction_type != against_list) %>%
  select(-employer, -occupation, -sub_id)
pro_contributions
anti_contributions <- contributions %>%
  filter(transaction_type == against_list)%>%
  select(-employer, -occupation, -sub_id)
anti_contributions
```

filter out list of candidates to workable d/r
```{r}
house_demsreps <- house_elections %>%
  filter(party == "R" | party == "D", general_votes != 0) %>%
  mutate(st_dist = paste(state, district)) %>%
  select(-state, -district, -primary_votes, -runoff_votes) 
glimpse(house_demsreps)
```

combined contributions and people data sets
```{r}
cand_conts <- contributions %>%
  group_by(cmte_id, cand_id) %>%
  rename(fec_id = cand_id) %>%
  summarize(total_cont = sum(transaction_amt)) %>%
  inner_join(house_demsreps)
glimpse(cand_conts)
```

total contributions for each candidate
```{r}
totcont_percandidate <- cand_conts%>%
  group_by(fec_id, candidate_name, incumbent, party, general_votes, ge_winner, st_dist) %>%
  summarize(totaldonations = sum(total_cont))
glimpse(totcont_percandidate)
```

```{r}
contested_districts <- totcont_percandidate %>%
  group_by(st_dist) %>%
  summarize(cont = n_distinct(fec_id)) %>%
  filter(cont != 1)

contested_contributions <- contested_districts %>%
  inner_join(totcont_percandidate, by = "st_dist")
contested_contributions
contested_contributions %>%
  summarize(ndist = n_distinct(st_dist))
```

make two separate data frames for democrats and republicans
```{r}
contested_contrib_reps <- contested_contributions %>%
  filter(party == "R")

contested_contrib_dems <- contested_contributions %>%
  filter(party == "D")
```

Find who spends more money total: democrats or republicans?

```{r}
dem_vs_repub <- contested_contributions %>%
  ggplot(aes(x = party, y = totaldonations, fill = party)) +
  geom_col(show.legend = FALSE) +
  scale_fill_manual(values = c("#34AAE0", "#E91D0E")) +
  scale_x_discrete(name = " ", labels = c("Democrat", "Republican")) +
  scale_y_continuous(name = "Total Donations (In Millions)", breaks = c(0e+00, 1e+08, 2e+08, 3e+08), labels = c("$0", "$100", "$200", "$300"))
dem_vs_repub
```

Do incumbents spend more or less than their opposition? Does it differ for republicans and democrats?

```{r}
incumbency <- contested_contributions %>%
  ggplot(aes(x = incumbent, y = totaldonations)) +
  geom_col()
incumbency

incumbency_party <- contested_contributions %>%
  ggplot(aes(x = incumbent, y = totaldonations, fill = party)) +
  geom_col(position = "dodge") +
  scale_x_discrete(name = " ", labels = c("Not Incumbent", "Incumbent")) +
  scale_y_continuous(name = "Total Donations", breaks = c(0e+00, 1e+06, 2e+06, 3e+06, 4e+06, 5e+06, 6e+06, 7e+06), labels = c("$0", "$1 Million", "$2 Million", "$3 Million", "$4 Million", "$5 Million", "$6 Million", "$7 Million")) +
  scale_fill_manual(values = c("#34AAE0", "#E91D0E"), name = "Party", labels = c("Democrat", "Republican"))
incumbency_party
```


Making the data graphic

```{r}
contested_contrib_dems %>%
  ggplot(aes(x = st_dist, y = totaldonations, col = incumbent)) +
  facet_wrap(~ge_winner) +
  geom_col()

contested_contrib_reps %>%
  ggplot(aes(x = st_dist, y = totaldonations, col = incumbent)) +
  facet_wrap(~ge_winner) +
  geom_col()
```


```{r}
contested_contributions %>%
  treemap(index=c("ge_winner", "party", "incumbent"),
        vSize = "totaldonations", 
        type="index")
```




