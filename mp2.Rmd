---
title: "Mini-Project 2"
author: "Marissa Freed, Natasha Rosenthal, & Margaret Welsh"
date: "March 31, 2018"
output: 
  html_document:
    code_folding: hide
---

Question: In contested House elections, looking at Democrats versus Republicans, who spends more money? Whose money is spent more effectively (which candidates win)? 
Does incumbency affect spending in contested elections?
To do: 
> Find who spends more money total: democrats or republicans? **
> Who wins more? Spends less doing so? (what percent of total spending for each race does the winner spend)
> Do incumbents spend more or less than their opposition? Does it differ for republicans and democrats? ***

## Loading the data
This project is so interesting and relevant to my life!

```{r, include=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(treemap)
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```
Viewing the data
```{r}
head(house_elections)
head(candidates)
head(committees)
head(contributions)
```

```{r}
contributions %>%
  group_by(transaction_type) %>%
  summarize(n_ish = n_distinct(transaction_type))
#summarizing the contributions data frame after grouping by transaction_type so that we could see which types were included in the data
against_list <- c("24A", "24N")
#we found that codes 24A and 24N were donations made against a candidate
pro_contributions <- contributions %>%
  filter(transaction_type != against_list) %>%
  select(-employer, -occupation, -sub_id)
#this data frame includes all transaction codes except 24A and 24N--the "against_list".
pro_contributions
anti_contributions <- contributions %>%
  filter(transaction_type == against_list)%>%
  select(-employer, -occupation, -sub_id)
#this data fram includes only the codes 24A and 24N
anti_contributions
```

```{r}
house_demsreps <- house_elections %>%
  filter(party == "R" | party == "D", general_votes != 0) %>%
  mutate(st_dist = paste(state, district)) %>%
  select(-state, -district, -primary_votes, -runoff_votes) 
#filtered the candidates in the house_elections data frame to only include Republican and Democrat candidates, and those did not have 0 votes in the general election
glimpse(house_demsreps)
```

combined contributions and people data sets
```{r}
cand_conts <- contributions %>%
  group_by(cmte_id, cand_id) %>%
  rename(fec_id = cand_id) %>%
  summarize(total_cont = sum(transaction_amt)) %>%
  inner_join(house_demsreps)
glimpse(cand_conts)
```

total contributions for each candidate
```{r}
totcont_percandidate <- cand_conts%>%
  group_by(fec_id, candidate_name, incumbent, party, general_votes, ge_winner, st_dist) %>%
  summarize(totaldonations = sum(total_cont))
glimpse(totcont_percandidate)
```

```{r}
contested_districts <- totcont_percandidate %>%
  group_by(st_dist) %>%
  summarize(cont = n_distinct(fec_id)) %>%
  filter(cont != 1)

contested_contributions <- contested_districts %>%
  inner_join(totcont_percandidate, by = "st_dist")
contested_contributions
contested_contributions %>%
  summarize(ndist = n_distinct(st_dist))
```

make two separate data frames for democrats and republicans
```{r}
contested_contrib_reps <- contested_contributions %>%
  filter(party == "R")

contested_contrib_dems <- contested_contributions %>%
  filter(party == "D")
```

Find who spends more money total: democrats or republicans?

```{r}
dem_vs_repub <- contested_contributions %>%
  ggplot(aes(x = party, y = totaldonations, fill = party)) +
  geom_col(show.legend = FALSE) +
  scale_fill_manual(values = c("#34AAE0", "#E91D0E")) +
  labs(title = "Total Donations Broken Down by Party") +
  scale_x_discrete(name = " ", labels = c("Democrat", "Republican")) +
  scale_y_continuous(name = "Total Donations (In Millions)", breaks = c(0e+00, 1e+08, 2e+08, 3e+08), labels = c("$0", "$100", "$200", "$300"))
dem_vs_repub
```

Do incumbents spend more or less than their opposition? Does it differ for republicans and democrats?

```{r}
incumbency <- contested_contributions %>%
  ggplot(aes(x = incumbent, y = totaldonations)) +
  geom_col() +
  labs(title = "Donations For Non-Incumbents vs. Incumbents") +
  scale_x_discrete(name = " ", labels = c("Non-Incumbent", "Incumbent")) +
  scale_y_continuous(name = "Total Donations (In Millions)", breaks = c(0e+00, .5e+08, 1e+08, 1.5e+08, 2e+08, 2.5e+08, 3e+08, 3.5e+08), labels = c("$0", "$50", "$100", "$150", "$200", "$250", "$300", "$350"))
incumbency

incumbency_party <- contested_contributions %>%
  ggplot(aes(x = incumbent, y = totaldonations, fill = party)) +
  geom_col(position = "dodge") +
  labs(title = "Donations For Non-Incumbents vs. Incumbents in Each Party") +
  scale_x_discrete(name = " ", labels = c("Non-Incumbent", "Incumbent")) +
  scale_y_continuous(name = "Total Donations", breaks = c(0e+00, 1e+06, 2e+06, 3e+06, 4e+06, 5e+06, 6e+06, 7e+06), labels = c("$0", "$1 Million", "$2 Million", "$3 Million", "$4 Million", "$5 Million", "$6 Million", "$7 Million")) +
  scale_fill_manual(values = c("#34AAE0", "#E91D0E"), name = "Party", labels = c("Democrat", "Republican"))
incumbency_party
```






